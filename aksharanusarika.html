<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>తెలుగు తునకలు: అక్షరానుసారిక: v0.0.3a</title>
  <style>
    body {
      margin: 1rem auto;
      padding: 0 1rem;
      max-width: 800px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f8f9fa;
    }
    .main-banner {
      text-align: center;
      margin-bottom: 1.5rem;
      font-size: 1.8rem;
      color: #1971c2;
      border-bottom: 2px solid #4dabf7;
      padding-bottom: 0.5rem;
    }
    textarea {
      width: 100%;
      min-height: 150px;
      font-size: 1.1rem;
      padding: 0.75rem;
      box-sizing: border-box;
      border-radius: 8px;
      border: 1px solid #ced4da;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    textarea:focus {
      outline: none;
      border-color: #228be6;
      box-shadow: 0 0 0 3px rgba(34, 139, 230, 0.2);
    }
    button {
      display: block;
      margin: 1rem auto 0;
      padding: 0.75rem 1.5rem;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      background-color: #228be6;
      color: white;
      transition: background-color 0.2s;
    }
    button:hover {
      background-color: #1c7ed6;
    }
    .results-area {
      margin-top: 2rem;
    }
    .analysis-heading {
      text-align: center;
      margin-top: 2.5rem;
      font-weight: bold;
      font-size: 1.5rem;
      color: #343a40;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #dee2e6;
      padding: 12px;
      text-align: left;
    }
    th {
      background-color: #f1f3f5;
      font-weight: 600;
    }
    td:first-child {
        font-weight: bold;
        font-size: 1.1rem;
    }
    /* Layout from v0.0.2a */
    .summary-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      align-items: flex-start;
      margin-top: 1.5rem;
      margin-bottom: 2rem;
    }
    .summary-col {
      display: flex;
      flex-direction: column;
      gap: 1.5rem; /* space between boxes */
      flex: 1 1 0; /* share space with the other column */
      min-width: 300px;
    }
    .summary-box {
      padding: 1rem 1.5rem;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      background: #fff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .summary-box h2 {
      margin-top: 0;
      color: #1971c2;
      border-bottom: 1px solid #f1f3f5;
      padding-bottom: 0.5rem;
      font-size: 1.2rem;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      background-color: #f8f9fa;
      padding: 1rem;
      border-radius: 4px;
      border: 1px solid #e9ecef;
    }
    .chart-container {
      position: relative;
      height: 350px;
      width: 100%;
    }
  </style>
  <!-- Include Chart.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <h1 class="main-banner">తెలుగు తునకలు: అక్షరానుసారిక: v0.0.3a</h1>

  <textarea id="teluguInput" placeholder="మీ తెలుగు వాక్యాన్ని ఇక్కడ ఉంచండి..."></textarea><br />
  <button id="analyzeBtn">విశ్లేషించు (Analyze)</button>

  <div class="results-area" id="resultsContainer"></div>

  <script>
    //////////////////////////////////////////////////////////////////////////
    // DATA AND CONSTANTS (v0.0.3a)
    //////////////////////////////////////////////////////////////////////////
    const dependentToIndependent = {
        "ా": "ఆ", "ి": "ఇ", "ీ": "ఈ", "ు": "ఉ", "ూ": "ఊ", "ృ": "ఋ",
        "ౄ": "ౠ", "ె": "ఎ", "ే": "ఏ", "ై": "ఐ", "ొ": "ఒ", "ో": "ఓ", "ౌ": "ఔ"
    };
    const halant = "్";
    const teluguConsonants = new Set([
        "క", "ఖ", "గ", "ఘ", "ఙ", "చ", "ఛ", "జ", "ఝ", "ఞ", "ట", "ఠ", "డ", "ఢ", "ణ",
        "త", "థ", "ద", "ధ", "న", "ప", "ఫ", "బ", "భ", "మ", "య", "ర", "ల", "వ",
        "శ", "ష", "స", "హ", "ళ", "ఱ"
    ]);
    const longVowels = new Set(["ా", "ీ", "ూ", "ే", "ో", "ౌ", "ౄ"]);
    const independentVowels = new Set([
        "అ", "ఆ", "ఇ", "ఈ", "ఉ", "ఊ", "ఋ", "ౠ", "ఎ", "ఏ", "ఐ", "ఒ", "ఓ", "ఔ"
    ]);
    const diacritics = new Set(["ం", "ః"]);
    const dependentVowels = new Set(Object.keys(dependentToIndependent));

    // Grammatical and Phonetic Sets
    const PLUTAMULU = new Set(["ఐ", "ఔ"]);
    const SARALAMULU = new Set(["గ", "జ", "డ", "ద", "బ"]);
    const PARUSHAMULU = new Set(["క", "చ", "ట", "త", "ప"]);
    const STHIRAMULU = new Set([
        "ఖ", "ఘ", "ఙ", "ఛ", "ఝ", "ఞ", "ఠ", "ఢ", "ణ", "థ", "ధ", "న",
        "ఫ", "భ", "మ", "య", "ర", "ఱ", "ల", "ళ", "వ", "శ", "ష", "స", "హ"
    ]);
    const KA_VARGAMU = new Set(["క", "ఖ", "గ", "ఘ", "ఙ"]);
    const CHA_VARGAMU = new Set(["చ", "ౘ", "ఛ", "జ", "ౙ", "ఝ", "ఞ"]);
    const TA_VARGAMU = new Set(["ట", "ఠ", "డ", "ఢ", "ణ"]);
    const THA_VARGAMU = new Set(["త", "థ", "ద", "ధ", "న"]);
    const PA_VARGAMU = new Set(["ప", "ఫ", "బ", "భ", "మ"]);
    const SPARSHA_MULU = new Set([...KA_VARGAMU, ...CHA_VARGAMU, ...TA_VARGAMU, ...THA_VARGAMU, ...PA_VARGAMU]);
    const OOSHMA_MULU = new Set(["శ", "స", "ష", "హ"]);
    const ANTASTA_MULU = new Set(["య", "ర", "ఱ", "ల", "ళ", "వ"]);
    const KANTHYAMULU = new Set(["అ", "ఆ", "క", "ఖ", "గ", "ఘ", "ఙ", "హ"]);
    const TAALAVYAMULU = new Set(["ఇ", "ఈ", "చ", "ఛ", "జ", "ఝ", "య", "శ"]);
    const MOORDHANYAMULU = new Set(["ఋ", "ౠ", "ట", "ఠ", "డ", "ఢ", "ణ", "ష", "ఱ", "ర"]);
    const DANTYAMULU = new Set(["ఌ", "ౡ", "త", "థ", "ద", "ధ", "ౘ", "ౙ", "ల", "స"]);
    const OOSHTYAMULU = new Set(["ఉ", "ఊ", "ప", "ఫ", "బ", "భ", "మ"]);
    const ANUNAASIKA_MULU = new Set(["ఙ", "ఞ", "ణ", "న", "మ"]);
    const KANTHATAALAVYA_MULU = new Set(["ఎ", "ఏ", "ఐ"]);
    const KANTHOSH_TYAMULU = new Set(["ఒ", "ఓ", "ఔ"]);
    const DANTYOSH_TYAMULU = new Set(["వ"]);

    //////////////////////////////////////////////////////////////////////////
    // HELPER FUNCTIONS
    //////////////////////////////////////////////////////////////////////////
    
    /**
     * Creates a simple 32-bit hash from a string for a unique ID.
     */
    function simpleHash(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        const chr = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + chr;
        hash |= 0; // Convert to 32bit integer
      }
      return (hash >>> 0).toString(16);
    }

    function addLetterCategories(ch, categories) {
        if (PLUTAMULU.has(ch)) categories.add("ప్లుతములు");
        if (SARALAMULU.has(ch)) categories.add("సరళములు");
        if (PARUSHAMULU.has(ch)) categories.add("పరుషములు");
        if (STHIRAMULU.has(ch)) categories.add("స్థిరములు");
        if (KA_VARGAMU.has(ch)) categories.add("క వర్గము");
        if (CHA_VARGAMU.has(ch)) categories.add("చ వర్గము");
        if (TA_VARGAMU.has(ch)) categories.add("ట వర్గము");
        if (THA_VARGAMU.has(ch)) categories.add("త వర్గము");
        if (PA_VARGAMU.has(ch)) categories.add("ప వర్గము");
        if (SPARSHA_MULU.has(ch)) categories.add("స్పర్శములు");
        if (OOSHMA_MULU.has(ch)) categories.add("ఊష్మాలు");
        if (ANTASTA_MULU.has(ch)) categories.add("అంతస్తములు");
        if (KANTHYAMULU.has(ch)) categories.add("కంఠ్యములు");
        if (TAALAVYAMULU.has(ch)) categories.add("తాలవ్యములు");
        if (MOORDHANYAMULU.has(ch)) categories.add("మూర్ధన్యములు");
        if (DANTYAMULU.has(ch)) categories.add("దంత్యములు");
        if (OOSHTYAMULU.has(ch)) categories.add("ఓష్ఠ్యములు");
        if (ANUNAASIKA_MULU.has(ch)) categories.add("అనునాసికములు");
        if (KANTHATAALAVYA_MULU.has(ch)) categories.add("కంఠతాలవ్యములు");
        if (KANTHOSH_TYAMULU.has(ch)) categories.add("కంఠోష్ఠ్యములు");
        if (DANTYOSH_TYAMULU.has(ch)) categories.add("దంత్యోష్ఠ్యములు");
    }

    //////////////////////////////////////////////////////////////////////////
    // CORE LOGIC (v0.0.3a)
    //////////////////////////////////////////////////////////////////////////

    function categorizeAksharam(aksharam) {
        const categories = new Set();
        if (independentVowels.has(aksharam[0])) {
            categories.add("అచ్చు");
        } else if (diacritics.has(aksharam)) {
            categories.add("అచ్చు");
        }
        if ([...aksharam].some(c => teluguConsonants.has(c))) {
            categories.add("హల్లు");
        }
        if ([...aksharam].some(c => longVowels.has(c))) {
            categories.add("దీర్ఘ");
        }
        if (aksharam.includes("ః")) categories.add("విసర్గ అక్షరం");
        if (aksharam.includes("ం")) categories.add("అనుస్వారం");

        let foundConjunct = false;
        let foundDouble = false;
        for (let i = 0; i < aksharam.length - 2; i++) {
            if (teluguConsonants.has(aksharam[i]) &&
                aksharam[i + 1] === halant &&
                teluguConsonants.has(aksharam[i + 2])) {
                if (aksharam[i] === aksharam[i + 2]) {
                    foundDouble = true;
                } else {
                    foundConjunct = true;
                }
            }
        }
        if (foundConjunct) categories.add("సంయుక్తాక్షరం");
        if (foundDouble) categories.add("ద్విత్వాక్షరం");

        if ((categories.has("హల్లు") || categories.has("అచ్చు")) &&
            !categories.has("దీర్ఘ") &&
            !categories.has("అనుస్వారం") &&
            !categories.has("విసర్గ అక్షరం")) {
            categories.add("హ్రస్వాక్షరం");
        }

        for (const ch of aksharam) {
            addLetterCategories(ch, categories);
        }

        let foundDependentVowel = false;
        for (const dvSign in dependentToIndependent) {
            if (aksharam.includes(dvSign)) {
                foundDependentVowel = true;
                addLetterCategories(dependentToIndependent[dvSign], categories);
                break; 
            }
        }

        if ([...aksharam].some(c => teluguConsonants.has(c)) && !foundDependentVowel) {
            addLetterCategories("అ", categories);
        }

        return Array.from(categories).sort();
    }

    function splitAksharalu(word) {
        const aksharalu = [];
        let i = 0;
        const n = word.length;
        while (i < n) {
            let current = [];
            const char = word[i];
            if (teluguConsonants.has(char)) {
                current.push(char);
                i++;
                while (i < n && word[i] === halant) {
                    current.push(word[i]);
                    i++;
                    if (i < n && teluguConsonants.has(word[i])) {
                        current.push(word[i]);
                        i++;
                    } else {
                        break;
                    }
                }
                while (i < n && (dependentVowels.has(word[i]) || diacritics.has(word[i]))) {
                    current.push(word[i]);
                    i++;
                }
            } else {
                current.push(char);
                i++;
                if (independentVowels.has(char) && i < n && diacritics.has(word[i])) {
                    current.push(word[i]);
                    i++;
                }
            }
            aksharalu.push(current.join(""));
        }

        if (aksharalu.length < 2) {
            return aksharalu.filter(ak => ak);
        }
        const finalAksharalu = [];
        let buffer = aksharalu[0];
        for (let j = 1; j < aksharalu.length; j++) {
            if (buffer.endsWith(halant)) {
                buffer += aksharalu[j];
            } else {
                finalAksharalu.push(buffer);
                buffer = aksharalu[j];
            }
        }
        finalAksharalu.push(buffer);
        return finalAksharalu.filter(ak => ak);
    }

    function analyzeTeluguWord(word) {
        const sanitized = word.replace(/[^\u0C00-\u0C7F]+/g, "");
        const uniqueId = simpleHash(sanitized);
        const aksharaluList = splitAksharalu(sanitized);
        const analysis = {};
        const categoryCounts = {};

        for (const aksharam of aksharaluList) {
            const tags = categorizeAksharam(aksharam);
            const key = aksharam;
            if (!analysis[key]) {
                analysis[key] = { tags, count: 0 };
            }
            analysis[key].count++;
        }
        
        for (const key in analysis) {
            const info = analysis[key];
            for (const cat of info.tags) {
                categoryCounts[cat] = (categoryCounts[cat] || 0) + info.count;
            }
        }

        return { uniqueId, analysis, categoryCounts };
    }

    //////////////////////////////////////////////////////////////////////////
    // UI AND DISPLAY LOGIC
    //////////////////////////////////////////////////////////////////////////
    let chartInstance = null;

    document.getElementById("analyzeBtn").addEventListener("click", () => {
        const rawText = document.getElementById("teluguInput").value || "";
        const resultsContainer = document.getElementById("resultsContainer");

        if (!rawText.trim()) {
            resultsContainer.innerHTML = "<p style='text-align:center;'>దయచేసి విశ్లేషణ కోసం కొంత వాక్యాన్ని నమోదు చేయండి.</p>";
            return;
        }

        const { uniqueId, analysis, categoryCounts } = analyzeTeluguWord(rawText);
        const sortedCats = Object.keys(categoryCounts).sort();
        const sortedAnalysis = Object.entries(analysis).sort((a, b) => b[1].count - a[1].count);

        // --- Build HTML for display (v0.0.2a layout) ---
        const summaryHtml = `
            <div class="summary-flex">
              <!-- LEFT COLUMN -->
              <div class="summary-col">
                <div class="summary-box">
                  <h2>సమాచారం (Info)</h2>
                  <p><strong>Unique ID:</strong> ${uniqueId}</p>
                  <strong>Original Input:</strong>
                  <pre>${rawText}</pre>
                </div>
                <div class="summary-box">
                  <div class="chart-container">
                    <canvas id="categoryChart"></canvas>
                  </div>
                </div>
              </div>
              <!-- RIGHT COLUMN -->
              <div class="summary-box" style="flex:1;">
                <h2>Category Counts</h2>
                <table>
                  <thead>
                    <tr><th>Category</th><th>Count</th></tr>
                  </thead>
                  <tbody>
                    ${sortedCats.map(cat => `
                      <tr>
                        <td>${cat}</td>
                        <td>${categoryCounts[cat]}</td>
                      </tr>
                    `).join('')}
                  </tbody>
                </table>
              </div>
            </div>
        `;

        const analysisTable = `
            <h2 class="analysis-heading">అక్షర విశ్లేషణ</h2>
            <table>
              <thead>
                <tr><th>అక్షరం (Syllable)</th><th>గణన (Count)</th><th>వర్గాలు (Tags)</th></tr>
              </thead>
              <tbody>
                ${sortedAnalysis.map(([aksharam, info]) => `
                  <tr>
                    <td>${aksharam}</td>
                    <td>${info.count}</td>
                    <td>${info.tags.join(", ")}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
        `;

        resultsContainer.innerHTML = summaryHtml + analysisTable;

        // --- Create Pie Chart ---
        if (chartInstance) {
            chartInstance.destroy();
        }
        const ctx = document.getElementById('categoryChart').getContext('2d');
        const backgroundColors = sortedCats.map((_, index) =>
            `hsl(${index * (360 / sortedCats.length)}, 70%, 60%)`
        );

        chartInstance = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: sortedCats,
                datasets: [{
                    label: 'Category Count',
                    data: sortedCats.map(cat => categoryCounts[cat]),
                    backgroundColor: backgroundColors,
                    borderColor: '#fff',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    }
                }
            }
        });
    });
  </script>

</body>
</html>
