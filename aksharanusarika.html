<!DOCTYPE html>
<html lang="te">
<head>
  <meta charset="UTF-8" />
  <title>తెలుగు తునకలు: అక్షరానుసారిక: v0.0.2a</title>
  <style>
    body {
      margin: 2rem auto;
      max-width: 650px;
      font-family: sans-serif;
      line-height: 1.5;
      color: #333;
    }
    /* Top Banner (Main heading) */
    h1.main-banner {
      text-align: center;
      margin-bottom: 1rem;
      font-size: 1.4rem;
      color: #444;
      border-bottom: 2px solid #ccc;
      padding-bottom: 0.5rem;
    }
    textarea {
      width: 100%;
      min-height: 120px;
      font-size: 1rem;
      padding: 0.5rem;
      box-sizing: border-box;
    }
    button {
      margin-top: 0.5rem;
      padding: 0.5rem 1rem;
      font-size: 1rem;
      cursor: pointer;
    }
    .results-area {
      margin-top: 1rem;
    }
    /* This heading is shown after clicking Analyze */
    h2.analysis-heading {
      text-align: center;
      margin-top: 2rem;
      font-weight: bold;
      font-size: 1.2rem;
      color: #444;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f7f7f7;
    }
    /* The main flex container for info & category counts */
    .summary-flex {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: flex-start;
      margin-top: 1rem;
      margin-bottom: 1rem;
    }
    /* The left column that stacks boxes (Info, Pie Chart, Category Info) */
    .summary-col {
      display: flex;
      flex-direction: column;
      gap: 1rem; /* space between boxes */
      flex: 1 1 0; /* share space with the other column */
    }
    /* Each info box */
    .summary-box {
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #fafafa;
    }
    .summary-box h2 {
      margin-top: 0;
    }
    pre {
      white-space: pre-wrap;
      word-wrap: break-word; 
    }
    /* Chart container styling for a minimalist look */
    .chart-container {
  margin: 0 auto;
  max-width: 600px;
  height: 400px; /* Increase the height as needed */
  background: #fafafa;
  padding: 1.5rem;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.chart-container canvas {
  height: 100%;
}
  </style>
  <!-- Include Chart.js from CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

  <h1 class="main-banner">తెలుగు తునకలు: అక్షరానుసారిక: v0.0.2a</h1>

  <textarea id="teluguInput" placeholder="మీ తెలుగు పరచూరిని ఇక్కడ ఉంచండి (పంక్ష్యుయేషన్లు, లైన్లు ఉంటేనూ పరవాలేదు) ..."></textarea><br />
  <button id="analyzeBtn">Analyze Text</button>

  <div class="results-area" id="resultsContainer"></div>

  <script>
    //////////////////////////////////////////////////////////////////////////
    // 1) Basic 32-bit hash for unique ID (Not true MD5, but a simple fallback)
    //////////////////////////////////////////////////////////////////////////
    function simpleHash(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        const chr = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + chr;
        // Convert to 32-bit integer
        hash |= 0;
      }
      // Return as unsigned (positive) 32-bit integer in hex
      return (hash >>> 0).toString(16);
    }

    //////////////////////////////////////////////////////////////////////////
    // 2) Data / Lookup sets
    //////////////////////////////////////////////////////////////////////////
    const HALANT = "్";

    // Dependent->Independent vowel mapping
    const dependentToIndependent = {
      "ా": "ఆ",
      "ి": "ఇ",
      "ీ": "ఈ",
      "ు": "ఉ",
      "ూ": "ఊ",
      "ృ": "ఋ",
      "ౄ": "ౠ",
      "ె": "ఎ",
      "ే": "ఏ",
      "ై": "ఐ",
      "ొ": "ఒ",
      "ో": "ఓ",
      "ౌ": "ఔ"
    };

    // Basic sets
    const teluguConsonants = new Set([
      "క", "ఖ", "గ", "ఘ", "ఙ", "చ", "ఛ", "జ", "ఝ", "ఞ",
      "ట", "ఠ", "డ", "ఢ", "ణ", "త", "థ", "ద", "ధ", "న",
      "ప", "ఫ", "బ", "భ", "మ", "య", "ర", "ల", "వ", "శ",
      "ష", "స", "హ", "ళ", "ఱ"
    ]);

    const longVowels = new Set(["ా", "ీ", "ూ", "ే", "ో", "ౌ", "ౄ"]);

    const independentVowels = new Set([
      "అ", "ఆ", "ఇ", "ఈ", "ఉ", "ఊ", "ఋ", "ౠ",
      "ఎ", "ఏ", "ఐ", "ఒ", "ఓ", "ఔ"
    ]);

    const diacritics = new Set(["ం", "ః"]);

    const dependentVowels = new Set(Object.keys(dependentToIndependent));

    // ----------------- Additional Category Sets -----------------
    const PLUTAMULU     = new Set(["ఐ", "ఔ"]);
    const SARALAMULU    = new Set(["గ", "జ", "డ", "ద", "బ"]);
    const PARUSHAMULU   = new Set(["క", "చ", "ట", "త", "ప"]);
    const STHIRAMULU    = new Set([
      "ఖ", "ఘ", "ఙ", "ఛ", "ఝ", "ఞ",
      "ఠ", "ఢ", "ణ", "థ", "ధ", "న",
      "ఫ", "భ", "మ", "య", "ర", "ఱ",
      "ల", "ళ", "వ", "శ", "ష", "స", "హ"
    ]);

    const KA_VARGAMU    = new Set(["క", "ఖ", "గ", "ఘ", "ఙ"]);
    const CHA_VARGAMU   = new Set(["చ", "ౘ", "ఛ", "జ", "ౙ", "ఝ", "ఞ"]);
    const TA_VARGAMU   = new Set(["ట", "ఠ", "డ", "ఢ", "ణ"]);
    const THA_VARGAMU  = new Set(["త", "థ", "ద", "ధ", "న"]);
    const PA_VARGAMU   = new Set(["ప", "ఫ", "బ", "భ", "మ"]);

    const SPARSHA_MULU  = new Set([...KA_VARGAMU, ...CHA_VARGAMU, ...TA_VARGAMU, ...THA_VARGAMU, ...PA_VARGAMU]);
    const OOSHMA_MULU   = new Set(["శ", "స", "ష", "హ"]);
    const ANTASTA_MULU  = new Set(["య", "ర", "ఱ", "ల", "ళ", "వ"]);

    const KANTHYAMULU       = new Set(["అ", "ఆ", "క", "ఖ", "గ", "ఘ", "ఙ", "హ"]);
    const TAALAVYAMULU     = new Set(["ఇ", "ఈ", "చ", "ఛ", "జ", "ఝ", "య", "శ"]);
    const MOORDHANYAMULU   = new Set(["ఋ", "ౠ", "ట", "ఠ", "డ", "ఢ", "ణ", "ష", "ఱ", "ర"]);
    const DANTYAMULU       = new Set(["ఌ", "ౡ", "త", "థ", "ద", "ధ", "ౘ", "ౙ", "ల", "స"]);
    const OOSHTYAMULU      = new Set(["ఉ", "ఊ", "ప", "ఫ", "బ", "భ", "మ"]);
    const ANUNAASIKAMULU    = new Set(["ఙ", "ఞ", "ణ", "న", "మ"]);
    const KANTHATAALAVYA_MU = new Set(["ఎ", "ఏ", "ఐ"]);
    const KANTHOSH_TYAMULU = new Set(["ఒ", "ఓ", "ఔ"]);
    const DANTYOSH_TYAMULU  = new Set(["వ"]);

    //////////////////////////////////////////////////////////////////////////
    // Helper function: addLetterCategories
    //////////////////////////////////////////////////////////////////////////
    function addLetterCategories(ch, categories) {
      if (PLUTAMULU.has(ch))    categories.add("ప్లుతము");
      if (SARALAMULU.has(ch))   categories.add("సరళము");
      if (PARUSHAMULU.has(ch))  categories.add("పరుషము");
      if (STHIRAMULU.has(ch))   categories.add("స్థిరము");

      if (KA_VARGAMU.has(ch))   categories.add("క వర్గము");
      if (CHA_VARGAMU.has(ch))  categories.add("చ వర్గము");
      if (TA_VARGAMU.has(ch))   categories.add("ట వర్గము");
      if (THA_VARGAMU.has(ch))  categories.add("త వర్గము");
      if (PA_VARGAMU.has(ch))   categories.add("ప వర్గము");

      if (SPARSHA_MULU.has(ch))   categories.add("స్పర్శము");
      if (OOSHMA_MULU.has(ch))    categories.add("ఊష్మాము");
      if (ANTASTA_MULU.has(ch))   categories.add("అంతస్తము");

      if (KANTHYAMULU.has(ch))        categories.add("కంఠ్యము");
      if (TAALAVYAMULU.has(ch))       categories.add("తాలవ్యము");
      if (MOORDHANYAMULU.has(ch))     categories.add("మూర్ధన్యము");
      if (DANTYAMULU.has(ch))         categories.add("దంత్యము");
      if (OOSHTYAMULU.has(ch))        categories.add("ఓష్ఠ్యము");
      if (ANUNAASIKAMULU.has(ch))     categories.add("అనునాసికము");
      if (KANTHATAALAVYA_MU.has(ch))  categories.add("కంఠతాలవ్యము");
      if (KANTHOSH_TYAMULU.has(ch))   categories.add("కంఠోష్ఠ్యము");
      if (DANTYOSH_TYAMULU.has(ch))   categories.add("దంత్యోష్ఠ్యము");
    }

    //////////////////////////////////////////////////////////////////////////
    // categorizeAksharam
    //////////////////////////////////////////////////////////////////////////
    function categorizeAksharam(aksharam) {
      const categories = new Set();

      // 1) Stand-alone vowel or diacritic
      if (independentVowels.has(aksharam)) {
        categories.add("అచ్చు");
      } else if (diacritics.has(aksharam)) {
        categories.add("అచ్చు");
        if (aksharam === "ం") {
          categories.add("అనుస్వరం");
        } else if (aksharam === "ః") {
          categories.add("విసర్గ అక్షరం");
        }
      }

      // 2) If chunk has any consonant => హల్లు
      let hasConsonant = false;
      for (let c of aksharam) {
        if (teluguConsonants.has(c)) {
          hasConsonant = true;
          categories.add("హల్లు");
          break;
        }
      }

      // 3) If chunk has any long vowel sign => దీర్ఘ
      for (let lv of longVowels) {
        if (aksharam.includes(lv)) {
          categories.add("దీర్ఘ అక్షరం");
          break;
        }
      }

      // 4) If chunk has 'ః' => visarga, 'ం' => anusvāra
      if (aksharam.includes("ః")) {
        categories.add("విసర్గ అక్షరం");
      }
      if (aksharam.includes("ం")) {
        categories.add("అనుస్వరం");
      }

      // 5) Detect C్C => సంయుక్తాక్షరం or ద్విత్వాక్షరం
      let foundConjunct = false;
      let foundDouble   = false;
      for (let i = 0; i < aksharam.length - 2; i++) {
        if (
          teluguConsonants.has(aksharam[i]) &&
          aksharam[i+1] === HALANT &&
          teluguConsonants.has(aksharam[i+2])
        ) {
          if (aksharam[i] === aksharam[i+2]) {
            foundDouble = true;
          } else {
            foundConjunct = true;
          }
        }
      }
      if (foundConjunct) {
        categories.add("సంయుక్తాక్షరం");
      }
      if (foundDouble) {
        categories.add("ద్విత్వాక్షరం");
      }

      // 6) "హ్రస్వాక్షరం" if letter but not దీర్ఘ/అనుస్వరం/విసర్గ
      const isLetter = (categories.has("హల్లు") || categories.has("అచ్చు"));
      const isLong   = categories.has("దీర్ఘ అక్షరం");
      const isAnus   = categories.has("అనుస్వరం");
      const isVis    = categories.has("విసర్గ అక్షరం");
      if (isLetter && !isLong && !isAnus && !isVis) {
        categories.add("హ్రస్వాక్షరం");
      }

      // --- Per-letter categories ---
      for (let ch of aksharam) {
        addLetterCategories(ch, categories);
      }

      // --- Dependent vowels => add implied vowel categories
      let foundDiacritic = false;
      for (let dvSign in dependentToIndependent) {
        if (aksharam.includes(dvSign)) {
          foundDiacritic = true;
          const impliedVowel = dependentToIndependent[dvSign];
          addLetterCategories(impliedVowel, categories);
        }
      }

      // --- If there's a consonant but NO diacritic => add categories of "అ"
      if (hasConsonant && !foundDiacritic) {
        addLetterCategories("అ", categories);
      }

      return Array.from(categories).sort();
    }

    //////////////////////////////////////////////////////////////////////////
    // splitAksharalu
    //////////////////////////////////////////////////////////////////////////
    function splitAksharalu(text) {
      const aksharalu = [];
      let i = 0;

      while (i < text.length) {
        const current = [];

        if (teluguConsonants.has(text[i])) {
          current.push(text[i]);
          i++;

          // Handle "్ + consonant" sequences
          while (i < text.length && text[i] === HALANT) {
            current.push(text[i]);
            i++;
            if (i < text.length && teluguConsonants.has(text[i])) {
              current.push(text[i]);
              i++;
            } else {
              break;
            }
          }

          // Dependent vowels or diacritics
          while (
            i < text.length &&
            (dependentVowels.has(text[i]) || diacritics.has(text[i]))
          ) {
            current.push(text[i]);
            i++;
          }
        } else {
          // stand-alone vowel or diacritic
          current.push(text[i]);
          i++;
        }
        aksharalu.push(current.join(""));
      }

      // Merge leftover "C + halant"
      const finalAksharalu = [];

      function isHalantChunk(ch) {
        return (ch.length === 2 &&
                teluguConsonants.has(ch[0]) &&
                ch[1] === HALANT);
      }

      for (let chunk of aksharalu) {
        if (finalAksharalu.length > 0 && isHalantChunk(chunk)) {
          finalAksharalu[finalAksharalu.length - 1] += chunk;
        } else {
          finalAksharalu.push(chunk);
        }
      }

      return finalAksharalu;
    }

    //////////////////////////////////////////////////////////////////////////
    // analyzeTeluguText => { uniqueId, analysis, categoryCounts }
    //////////////////////////////////////////////////////////////////////////
    function analyzeTeluguText(rawText) {
      const sanitized = rawText.replace(/[^\u0C00-\u0C7F]+/g, "");
      const uniqueId = simpleHash(sanitized);

      const aksharaluList = splitAksharalu(sanitized);
      const analysis = {};

      for (let aksharam of aksharaluList) {
        const tags = categorizeAksharam(aksharam);
        if (!analysis[aksharam]) {
          analysis[aksharam] = { tags, count: 0 };
        }
        analysis[aksharam].count++;
      }

      // categoryCounts
      const categoryCounts = {};
      for (let aksharam in analysis) {
        const info = analysis[aksharam];
        for (let cat of info.tags) {
          if (!categoryCounts[cat]) {
            categoryCounts[cat] = 0;
          }
          categoryCounts[cat] += info.count;
        }
      }

      return { uniqueId, analysis, categoryCounts };
    }

    //////////////////////////////////////////////////////////////////////////
    // 7) On button click => analyze & display
    //////////////////////////////////////////////////////////////////////////
    document.getElementById("analyzeBtn").addEventListener("click", () => {
      const rawText = document.getElementById("teluguInput").value || "";
      const resultsContainer = document.getElementById("resultsContainer");

      if (!rawText.trim()) {
        resultsContainer.innerHTML = "<p>Please enter some text.</p>";
        return;
      }

      // Analyze text
      const { uniqueId, analysis, categoryCounts } = analyzeTeluguText(rawText);
      const sortedCats = Object.keys(categoryCounts).sort();

      // (A) Secondary Banner
      const secondaryBanner = `
        <h2 class="analysis-heading">అక్షర విశ్లేషణ</h2>
      `;

      // (B) Summary-Flex: Left column contains Info box, Pie Chart, and Category Info; Right column contains Category Counts table.
      const summaryHtml = `
        <div class="summary-flex">
          <!-- LEFT COLUMN (stacked) -->
          <div class="summary-col">
            <!-- Info box -->
            <div class="summary-box">
              <h2>Info</h2>
              <p><strong>Unique ID:</strong> ${uniqueId}</p>
              <h3>Original Input:</h3>
              <pre>${rawText}</pre>
            </div>
            <!-- Pie Chart box -->
            <div class="summary-box">
              <div class="chart-container">
                <canvas id="categoryChart"></canvas>
              </div>
            </div>
          </div>
          <!-- RIGHT COLUMN: Category Counts table -->
          <div class="summary-box" style="flex:1;">
            <h2>Category Counts</h2>
            <table>
              <thead>
                <tr><th>Category</th><th>Count</th></tr>
              </thead>
              <tbody>
                ${sortedCats.map(cat => `
                  <tr>
                    <td>${cat}</td>
                    <td>${categoryCounts[cat]}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
      `;

      // (C) Main Analysis Table
      const analysisTable = `
        <table>
          <thead>
            <tr>
              <th>Aksharam</th>
              <th>Count</th>
              <th>Tags</th>
            </tr>
          </thead>
          <tbody>
            ${Object.entries(analysis).map(([aksharam, info]) => `
              <tr>
                <td>${aksharam}</td>
                <td>${info.count}</td>
                <td>${info.tags.join(", ")}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;

      // Set the innerHTML with all sections
      resultsContainer.innerHTML = secondaryBanner + summaryHtml + analysisTable;

      // Create the dynamic pie chart using Chart.js
      const ctx = document.getElementById('categoryChart').getContext('2d');
      const backgroundColors = sortedCats.map((cat, index) =>
        `hsl(${index * (360 / sortedCats.length)}, 70%, 60%)`
      );

      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: sortedCats,
          datasets: [{
            data: sortedCats.map(cat => categoryCounts[cat]),
            backgroundColor: backgroundColors,
          }]
        },
        options: {
          plugins: {
            legend: {
              position: 'bottom'
            }
          },
          maintainAspectRatio: false,
        }
      });
    });
  </script>

</body>
</html>
